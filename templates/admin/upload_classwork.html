from flask import redirect, url_for, flash

@app.route('/admin/upload-classwork', methods=['GET', 'POST'])
@admin_required
def upload_classwork():
    if request.method == 'POST':
        # Get form data
        class_name = request.form.get('class_name')
        subject = request.form.get('subject')
        title = request.form.get('title')
        description = request.form.get('description')
        due_date = request.form.get('due_date')
        file = request.files.get('file')

        # Validate required fields
        if not all([class_name, subject, title, file]):
            flash('Please fill all required fields', 'danger')
            return redirect(url_for('upload_classwork'))

        # Validate file type
        allowed_extensions = ['pdf', 'doc', 'docx', 'ppt', 'pptx']
        if '.' in file.filename and file.filename.rsplit('.', 1)[1].lower() not in allowed_extensions:
            flash('Invalid file type. Allowed formats: PDF, DOC, DOCX, PPT, PPTX', 'danger')
            return redirect(url_for('upload_classwork'))

        try:
            # Save the file (implement your file saving logic here)
            # Example:
            # filename = secure_filename(file.filename)
            # file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
            
            # Save to database (implement your database logic here)
            
            flash('Class work uploaded successfully!', 'success')
            return redirect(url_for('upload_classwork'))  # Stay on same page after upload
            
        except Exception as e:
            flash(f'Error uploading file: {str(e)}', 'danger')
            return redirect(url_for('upload_classwork'))

    return render_template('upload_classwork.html')
